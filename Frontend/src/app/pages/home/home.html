<!-- Wrapper del estado -->
<div *ngIf="!loading && !error; else stateTpl">
  <!-- Bloque principal centrado y con ancho limitado -->
  <div class="home-container">
    <!-- Grid interno del dashboard -->
    <div class="home-wrap">
      
      <!-- FILA 1: KPIs -->
      <section class="grid-3">
        <sl-info-card [label]="''" [value]="summary?.totalBudget | currency:'EUR':'symbol':'1.0-0'">
          <div class="kpi-head"><i class="bi bi-wallet2 kpi-icon"></i> Presupuesto total</div>
          <div class="kpi-sub">Actualizado: {{ summary?.updatedAt | date:'mediumDate' }}</div>
        </sl-info-card>

        <sl-info-card [label]="''" [value]="summary?.spent | currency:'EUR':'symbol':'1.0-0'" class="warning">
          <div class="kpi-head"><i class="bi bi-arrow-down-circle kpi-icon text-danger"></i> Gasto acumulado</div>
          <div class="kpi-bar">
            <div class="kpi-bar-fill" [style.width.%]="spentPct"></div>
          </div>
          <div class="kpi-sub">Usado: {{ spentPct }}%</div>
        </sl-info-card>

        <sl-info-card [label]="''" [value]="summary?.income | currency:'EUR':'symbol':'1.0-0'" class="success">
          <div class="kpi-head"><i class="bi bi-arrow-up-circle kpi-icon text-success"></i> Ingresos acumulados</div>
          <a class="kpi-link" [routerLink]="['/transactions']">Ver transacciones</a>
        </sl-info-card>
      </section>

      <!-- FILA 2: Solicitudes + Distritos -->
      <section class="grid-2">
        <div>
          <div class="card card-section">
            <div class="card-head">
              <h3><i class="bi bi-list-task section-icon"></i> Solicitudes</h3>
            </div>
            <app-resumen-requests></app-resumen-requests>
          </div>
        </div>
 

        <div class="card chart-card">
          <div class="card-head">
            <h3><i class="bi bi-geo-alt section-icon"></i> Operaciones Por Barrios</h3>
            <a class="card-link" [routerLink]="['/patrimony']">Ir a Patrimonio</a>
          </div>
          <div class="chart-host">
            <canvas baseChart [data]="barData" [options]="barOptions" [type]="'bar'"></canvas>
          </div>
        </div>
      </section>

      <!-- FILA 3: Transacciones recientes -->
      <section class="grid-1">
        <div class="card">
          <div class="card-head">
            <h3><i class="bi bi-arrow-left-right section-icon"></i> Últimas transacciones</h3>
            <a class="card-link" [routerLink]="['/transacciones']">Ver todas</a>
          </div>
          <ul class="tx-list">
            <li *ngFor="let t of transactions" [ngClass]="{'tx-income': t.type === 'INGRESO', 'tx-expense': t.type === 'GASTO'}">
              <div class="tx-left">
                <div class="tx-desc">{{ t.description }}</div>
                <div class="tx-date">{{ t.transactionDate | date:'mediumDate' }}</div>
              </div>
              <div class="tx-amount">
                {{ t.amount | currency:'EUR':'symbol':'1.0-0' }}
              </div>
            </li>
          </ul>
        </div>
      </section>

    </div>
  </div>
</div>

<ng-template #stateTpl>
  <div class="state" *ngIf="loading">Cargando dashboard…</div>
  <div class="state error" *ngIf="!loading && error">{{ error }}</div>
</ng-template>
