<div class="requests-page">
  <div class="container requests-container">

    <!-- Título -->
    <header class="rq-header">
      <h2 class="rq-title text-center">Requests</h2>
    </header>

    <!-- Infocards -->
 <section class="requests-kpis row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-xl-5 g-3 mb-3 mt-2">
  <!-- Total -->
  <div class="col">
<sl-info-card label="Total" [value]="getEstadoTotal('Recibido') + getEstadoTotal('Pendiente') + getEstadoTotal('Aprobado') + getEstadoTotal('Rechazado')">
  <i class="bi bi-bell ic-mini ic-total"></i>
</sl-info-card>
  </div>

  <!-- Recibidos -->
  <div class="col">
<sl-info-card label="Recibidos" [value]="getEstadoTotal('Recibido')">
  <i class="bi bi-inbox ic-mini ic-recibidos"></i>
</sl-info-card>
  </div>

  <!-- Pendientes -->
  <div class="col">
<sl-info-card label="Pendientes" [value]="getEstadoTotal('Pendiente')">
  <i class="bi bi-exclamation-triangle ic-mini ic-pendientes"></i>
</sl-info-card>
  </div>

  <!-- Completadas (Aprobado) -->
  <div class="col">
<sl-info-card label="Completadas" [value]="getEstadoTotal('Aprobado')">
  <i class="bi bi-check-circle ic-mini ic-completadas"></i>
</sl-info-card>
  </div>

  <!-- Rechazadas -->
  <div class="col">
<sl-info-card label="Rechazadas" [value]="getEstadoTotal('Rechazado')">
  <i class="bi bi-x-circle ic-mini ic-rechazadas"></i>
</sl-info-card>
  </div>
</section>

    <!-- Tabs segmentados -->
<section class="rq-tabs mb-3">
  <div class="rq-segment" role="tablist" aria-label="Filtros de requests">
    <button type="button" class="rq-segment__btn"
            [class.active]="!selectedStatus"
            (click)="selectedStatus=''; onStatusChange()"
            role="tab" [attr.aria-selected]="!selectedStatus">
  Todas
    </button>

    <button type="button" class="rq-segment__btn"
            [class.active]="selectedStatus==='Recibido'"
            (click)="selectedStatus='Recibido'; onStatusChange()"
            role="tab" [attr.aria-selected]="selectedStatus==='Recibido'">
  Recibidas
    </button>

    <button type="button" class="rq-segment__btn"
            [class.active]="selectedStatus==='Pendiente'"
            (click)="selectedStatus='Pendiente'; onStatusChange()"
            role="tab" [attr.aria-selected]="selectedStatus==='Pendiente'">
  Pendientes
    </button>

    <button type="button" class="rq-segment__btn"
            [class.active]="selectedStatus==='Aprobado'"
            (click)="selectedStatus='Aprobado'; onStatusChange()"
            role="tab" [attr.aria-selected]="selectedStatus==='Aprobado'">
  Completadas
    </button>

    <button type="button" class="rq-segment__btn"
            [class.active]="selectedStatus==='Rechazado'"
            (click)="selectedStatus='Rechazado'; onStatusChange()"
            role="tab" [attr.aria-selected]="selectedStatus==='Rechazado'">
  Rechazadas
    </button>
  </div>
</section>

    <!--Select de estado para móvil o accesibilidad -->
<div class="rq-toolbar mb-3 d-lg-none d-flex justify-content-center">
  <select class="form-select rq-select w-auto"
          [(ngModel)]="selectedStatus"
          (ngModelChange)="onStatusChange()">
    <option value="">Todas</option>
    <option value="Recibido">Recibidas</option>
    <option value="Pendiente">Pendientes</option>
    <option value="Aprobado">Completadas</option>
    <option value="Rechazado">Rechazadas</option>
  </select>
</div>


    <!-- Lista de requests -->
    <ul class="rq-list list-unstyled">
      <li *ngFor="let request of requestsData" class="rq-item">
        <sl-request-card
          [request]="request"
          [building]="request.building"
          (statusChanged)="onStatusChanged()">
        </sl-request-card>
      </li>
    </ul>

    <!-- Paginación -->
    <app-paginacion
      [currentPage]="page"
      [totalPages]="totalPages"
      (pageChange)="page = $event; loadRequests()">
    </app-paginacion>

    <p *ngIf="requestsData.length === 0" class="text-center text-muted mt-3">No hay requests disponibles.</p>
  </div>
</div>
