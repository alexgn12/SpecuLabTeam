<div class="container mt-4">
  <div class="d-flex align-items-center justify-content-between mb-2">
    <div>
      <h2 class="fw-bold mb-1">Gestión de Patrimonio</h2>
      <p class="text-muted mb-0">Dashboard de validación y control de adquisiciones inmobiliarias</p>
    </div>
    <span class="badge rounded-pill bg-primary-subtle text-primary fw-semibold px-3 py-2">
      Sistema Activo
    </span>
  </div>

  <!-- Loading / Error -->
  <div *ngIf="loading" class="alert alert-info my-3">Cargando datos...</div>
  <div *ngIf="!loading && error" class="alert alert-danger my-3">{{ error }}</div>

  <!-- Métricas -->
  <div *ngIf="!loading && !error" class="row g-3 mb-3">
    <div class="col-12 col-md-3">
      <div class="card metric-card shadow-sm">
        <div class="card-body">
          <div class="text-muted small">Patrimonio Total</div>
          <h3 class="fw-bold mb-1">{{ totalBudget | currency:'EUR' }}</h3>
          <span class="badge bg-success-subtle text-success fw-semibold">Actualizado</span>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-3">
      <div class="card metric-card shadow-sm">
        <div class="card-body">
          <div class="text-muted small">Presupuestos en Cartera</div>
          <h3 class="fw-bold mb-1">{{ countBudgets }}</h3>
          <span class="badge bg-success-subtle text-success fw-semibold">+{{ countBudgets ? 1 : 0 }}</span>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-3" *ngIf="avgProfit !== null">
      <div class="card metric-card shadow-sm bg-success-soft">
        <div class="card-body">
          <div class="text-muted small">Rentabilidad Media</div>
          <h3 class="fw-bold mb-1">{{ avgProfit }}%</h3>
          <span class="badge bg-success-subtle text-success fw-semibold">Variación</span>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-3" *ngIf="pendingCount !== null">
      <div class="card metric-card shadow-sm">
        <div class="card-body">
          <div class="text-muted small">Pendientes Validación</div>
          <h3 class="fw-bold mb-1">{{ pendingCount }}</h3>
          <span class="badge bg-primary-subtle text-primary fw-semibold">Nuevos</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Secciones -->
  <div *ngIf="!loading && !error" class="row g-3">
    <!-- Estado de Comunicación API -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white fw-bold">Estado de Comunicación API</div>
        <div class="card-body">
          <div class="status-row bg-success-subtle text-success">
            <span>Sistema de Presupuestos</span>
            <span class="badge bg-success">Conectado</span>
          </div>

          <div class="status-row">
            <span>Última Sincronización</span>
            <small class="text-muted">{{ lastSync | date:'short' }}</small>
          </div>

          <div class="status-row">
            <span>Presupuestos Recibidos Hoy</span>
            <span class="text-primary fw-bold">{{ receivedToday }} nuevos</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Resumen de Validaciones 
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white fw-bold">Resumen de Validaciones</div>
        <div class="card-body">
          <div class="d-flex justify-content-between py-1" *ngIf="approvedCount !== null">
            <span>Aprobadas este mes</span>
            <span class="text-success fw-bold">{{ approvedCount }}</span>
          </div>
          <div class="d-flex justify-content-between py-1" *ngIf="rejectedCount !== null">
            <span>Rechazadas este mes</span>
            <span class="text-danger fw-bold">{{ rejectedCount }}</span>
          </div>
          <div class="d-flex justify-content-between py-1" *ngIf="pendingCount !== null">
            <span>Pendientes de revisión</span>
            <span class="text-warning fw-bold">{{ pendingCount }}</span>
          </div>

          <hr *ngIf="approvedCount !== null || rejectedCount !== null || pendingCount !== null">
          <div class="d-flex justify-content-between" *ngIf="approvedCount !== null && (approvedCount + (rejectedCount || 0) + (pendingCount || 0)) > 0">
            <span>Tasa de Aprobación</span>
            <span class="text-primary fw-bold">
              {{
                (approvedCount! /
                  (approvedCount! + (rejectedCount || 0) + (pendingCount || 0))
                ) | percent:'1.0-0'
              }}
            </span>
          </div>
          <div class="text-muted" *ngIf="approvedCount === null && rejectedCount === null && pendingCount === null">
            No hay información de estados en el JSON.
          </div>
        </div>
      </div>
    </div> -->
  </div>
</div>
