<div class="requests-page">

<div class="container requests-container">
 <header class="patrimony-header">
      <h2 class="page-title">Patrimonio</h2>
      <p class="page-subtitle">Edificios comprados y apartamentos alquilados</p>
    </header>

<mat-accordion class="patrimony-accordion enterprise">
  <mat-expansion-panel class="p-card d-flex flex-column" *ngFor="let b of pagedBuildings">
    <!-- Header en cuadrícula, con botón que no dispara la expansión -->
    <mat-expansion-panel-header class="p-header">
      <div class="p-row">
        <div class="c c-name">
          <strong>{{ b.buildingName }}</strong>
          <span class="muted">({{ b.buildingCode }})</span>
        </div>
        <div class="c c-address">
          {{ b.street }}, {{ b.district }}
        </div>
        <div class="c c-year">
          <span class="label">Año</span> {{ b.yearBuilt }}
        </div>
        <div class="c c-actions">
          <button class="btn-primary-sm"
                  (click)="viewBuildingDetails(b); $event.stopPropagation()">
            Detalles
          </button>
        </div>
      </div>
      <!-- Flecha abajo centrada, dentro del header -->
      <div style="padding-left:20px ;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" width="24" height="24" aria-hidden="true" focusable="false" style="display:block;margin:0 auto;fill:#64748b;">
          <path d="M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z"></path>
        </svg>
      </div>
    </mat-expansion-panel-header>

    <!-- Cuerpo -->
    <h5 class="block-title text-center">Apartamentos en este edificio</h5>

    <ng-container *ngIf="getApartmentsByBuildingCode(b.buildingCode).length > 0; else noApts">
      <div class="table-shell">
  <table class="table table-compact">
    <!-- Define anchos estables por columna -->
    <colgroup>
      <col class="w-code" />
      <col class="w-door" />
      <col class="w-floor" />
      <col class="w-rooms" />
      <col class="w-baths" />
      <col class="w-actions" />
    </colgroup>

    <thead>
      <tr>
        <th class="ta-left">Código</th>
        <th class="ta-center">Pta</th>
        <th class="ta-right">Piso</th>
        <th class="ta-right">Habit.</th>
        <th class="ta-right">Baños</th>
        <th class="ta-right">Acciones</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let a of getApartmentsByBuildingCode(b.buildingCode)">
        <td class="ta-left mono">{{ a.apartmentCode }}</td>
        <td class="ta-center">{{ a.apartmentDoor }}</td>
        <td class="ta-right">{{ a.apartmentFloor }}</td>
        <td class="ta-right">{{ a.numberOfRooms }}</td>
        <td class="ta-right">{{ a.numberOfBathrooms }}</td>
        <td class="ta-right">
          <button class="btn btn-outline-primary btn-sm"
                  (click)="viewApartmentDetails(a); $event.stopPropagation()">
            Ver detalles
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>


    </ng-container>

    <ng-template #noApts>
      <div class="empty muted">No hay apartamentos alquilados en este edificio.</div>
    </ng-template>
  </mat-expansion-panel>
</mat-accordion>
</div>


</div>